import {exec} from 'child_process';
import fs from 'fs-extra';
import ora from 'ora';
import path from 'path';
import {promisify} from 'util';

/**
 * Create a script tag boilerplate
 * @return {Promise<void>}
 */
export default async function makeScriptTag() {
  const spinner = ora().start();
  spinner.info(`Generating script tag`);
  // Copy directory to destination
  const cwd = process.cwd();
  // Copy .env to destination
  spinner.start('Copying the script tag template to the current directory');

  await fs.copy(
    path.resolve(__dirname, '../../../storage/scriptTag'),
    `${cwd}/packages/scripttag`
  );

  spinner.start('Installing all dependencies');
  const asyncExec = promisify(exec);
  await asyncExec('yarn install', {cwd});
  spinner.info('Installed all dependencies');

  spinner.succeed(`Congratulations! Generate script tag successfully`);
}
