import {promises as fs} from 'fs';
import path from 'path';
import compile from 'string-template';

/**
 * Compile stub to string
 *
 * @param {string} stubName
 * @param {object} data
 * @param {string} destination
 * @return {Promise<void>}
 */
export async function generateFile(
  stubName: string,
  data: {[key: string]: string},
  destination: string
) {
  const fileContent = await fs.readFile(
    path.resolve(__dirname, `../../storage/stubs/${stubName}.stub`),
    'utf8'
  );
  const compiledContent = compile(fileContent, data);
  await fs.writeFile(destination, compiledContent, {flag: 'wx'});
}
